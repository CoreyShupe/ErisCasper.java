<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WebhookClientBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ErisCasper.java</a> &gt; <a href="index.source.html" class="el_package">net.dv8tion.jda.webhook</a> &gt; <span class="el_source">WebhookClientBuilder.java</span></div><h1>WebhookClientBuilder.java</h1><pre class="source lang-java linenums">/*
 *     Copyright 2015-2018 Austin Keener &amp; Michael Ritter &amp; Florian Spie√ü
 *     Copyright 2018-2018 &quot;Princess&quot; Lana Samson
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package net.dv8tion.jda.webhook;

import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.ThreadFactory;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import net.dv8tion.jda.core.entities.Webhook;
import net.dv8tion.jda.core.utils.Checks;
import net.dv8tion.jda.core.utils.MiscUtil;
import okhttp3.OkHttpClient;

/**
 * Builder that creates a new {@link net.dv8tion.jda.webhook.WebhookClient WebhookClient} instance
 */
public class WebhookClientBuilder {
<span class="nc" id="L33">  public static final OkHttpClient.Builder DEFAULT_HTTP_BUILDER = new OkHttpClient.Builder();</span>
<span class="nc" id="L34">  private static final Pattern WEBHOOK_PATTERN =</span>
<span class="nc" id="L35">      Pattern.compile(</span>
          &quot;(?:https?://)?(?:\\w+\\.)?discordapp\\.com/api(?:/v\\d+)?/webhooks/(\\d+)/([\\w-]+)(?:/(?:\\w+)?)?&quot;);

  protected final long id;
  protected final String token;
  protected ScheduledExecutorService pool;
  protected OkHttpClient.Builder builder;
  protected OkHttpClient client;
  protected ThreadFactory threadFactory;
  protected boolean isDaemon;

  /**
   * Creates a new WebhookClientBuilder with the provided id and token
   *
   * @param id The snowflake id of the target webhook
   * @param token The authorization token of the target webhook &lt;br&gt;
   *     &lt;b&gt;This is not a bot/client token!&lt;/b&gt;
   * @throws java.lang.IllegalArgumentException If the provided token is {@code null} or contains
   *     any whitespace!
   */
<span class="nc" id="L55">  public WebhookClientBuilder(final long id, final String token) {</span>
<span class="nc" id="L56">    Checks.noWhitespace(token, &quot;Token&quot;);</span>
<span class="nc" id="L57">    this.id = id;</span>
<span class="nc" id="L58">    this.token = token;</span>
<span class="nc" id="L59">  }</span>

  /**
   * Creates a new WebhookClientBuilder with the provided webhook URL
   *
   * @param url The URL of the webhook. May be directly copied from Discord's UI &lt;br&gt;
   *     Example: {@code https://discordapp.com/api/webhooks/123456789012345678/my-webhook-token}
   *     &lt;br&gt;
   *     This constructor also parses URLs pointing to subdomains of {@code discordapp.com}
   * @throws java.lang.IllegalArgumentException If the provided URL is {@code null} or is
   *     incorrectly formatted
   */
<span class="nc" id="L71">  public WebhookClientBuilder(String url) {</span>
<span class="nc" id="L72">    Matcher matcher = WEBHOOK_PATTERN.matcher(url);</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">    if (!matcher.matches()) {</span>
<span class="nc" id="L74">      throw new IllegalArgumentException(&quot;Failed to parse webhook URL&quot;);</span>
    }

<span class="nc" id="L77">    this.id = MiscUtil.parseSnowflake(matcher.group(1));</span>
<span class="nc" id="L78">    this.token = matcher.group(2);</span>
<span class="nc" id="L79">  }</span>

  /**
   * Creates a new WebhookClientBuilder with the provided id and token
   *
   * @param webhook The target {@link net.dv8tion.jda.core.entities.Webhook Webhook}
   * @throws java.lang.NullPointerException If the provided {@link
   *     net.dv8tion.jda.core.entities.Webhook Webhook} is {@code null}
   */
  public WebhookClientBuilder(Webhook webhook) {
<span class="nc" id="L89">    this(webhook.getIdLong(), webhook.getToken());</span>
<span class="nc" id="L90">  }</span>

  /**
   * The {@link java.util.concurrent.ScheduledExecutorService ScheduledExecutorService} that should
   * be used to handle rate limits! &lt;br&gt;
   * By default this creates a new executor with 1 core thread!
   *
   * &lt;p&gt;&lt;b&gt;&lt;u&gt;Closing the {@link net.dv8tion.jda.webhook.WebhookClient WebhookClient} will close
   * this executor service!&lt;/u&gt;&lt;/b&gt;
   *
   * @param executorService The executor service that should be used
   * @return The current WebhookClientBuilder for chaining convenience
   */
  public WebhookClientBuilder setExecutorService(ScheduledExecutorService executorService) {
<span class="nc" id="L104">    this.pool = executorService;</span>
<span class="nc" id="L105">    return this;</span>
  }

  /**
   * The {@link okhttp3.OkHttpClient OkHttpClient} that should be used to make HTTP requests!
   *
   * &lt;p&gt;Setting this will skip the {@link #setHttpClientBuilder(okhttp3.OkHttpClient.Builder)
   * setHttpClientBuilder(OkHttpClient.Builder)} setting and directly use the provided client!
   *
   * @param client The client that should be used
   * @return The current WebhookClientBuilder for chaining convenience
   */
  public WebhookClientBuilder setHttpClient(OkHttpClient client) {
<span class="nc" id="L118">    this.client = client;</span>
<span class="nc" id="L119">    return this;</span>
  }

  /**
   * The {@link okhttp3.OkHttpClient.Builder OkHttpClient.Builder} that should be used to create the
   * {@link okhttp3.OkHttpClient OkHttpClient} of the resulting {@link
   * net.dv8tion.jda.webhook.WebhookClient WebhookClient}! &lt;br&gt;
   * If not set or {@code null} this builder will use the {@link #DEFAULT_HTTP_BUILDER} instance.
   *
   * &lt;p&gt;This setting is ignored if {@link #setHttpClient(okhttp3.OkHttpClient)} is set!
   *
   * @param builder The builder that should be used
   * @return The current WebhookClientBuilder for chaining convenience
   */
  public WebhookClientBuilder setHttpClientBuilder(OkHttpClient.Builder builder) {
<span class="nc" id="L134">    Checks.notNull(builder, &quot;Builder&quot;);</span>
<span class="nc" id="L135">    this.builder = builder;</span>
<span class="nc" id="L136">    return this;</span>
  }

  /**
   * Factory that should be used by the default {@link java.util.concurrent.ScheduledExecutorService
   * ScheduledExecutorService} to create Threads for rate limitation handling of the created {@link
   * net.dv8tion.jda.webhook.WebhookClient WebhookClient}! &lt;br&gt;
   * This allows changing thread information such as name without having to create your own
   * executor.
   *
   * @param factory The {@link java.util.concurrent.ThreadFactory ThreadFactory} that will be used
   *     when no {@link java.util.concurrent.ScheduledExecutorService ScheduledExecutorService} has
   *     been set via {@link #setExecutorService(ScheduledExecutorService)}
   * @return The current WebhookClientBuilder for chaining convenience
   */
  public WebhookClientBuilder setThreadFactory(ThreadFactory factory) {
<span class="nc" id="L152">    this.threadFactory = factory;</span>
<span class="nc" id="L153">    return this;</span>
  }

  /**
   * Whether rate limit threads of the created {@link net.dv8tion.jda.webhook.WebhookClient
   * WebhookClient} should be treated as {@link Thread#isDaemon()} or not. &lt;br&gt;
   * &lt;b&gt;Default: false&lt;/b&gt;
   *
   * &lt;p&gt;This will not be used when the default thread pool has been set via {@link
   * #setExecutorService(ScheduledExecutorService)}!
   *
   * @param isDaemon True, if the threads should be daemon
   * @return The current WebhookClientBuilder for chaining convenience
   */
  public WebhookClientBuilder setDaemon(boolean isDaemon) {
<span class="nc" id="L168">    this.isDaemon = isDaemon;</span>
<span class="nc" id="L169">    return this;</span>
  }

  /**
   * Builds a new {@link net.dv8tion.jda.webhook.WebhookClient WebhookClient} instance with the
   * current state of this builder.
   *
   * &lt;p&gt;&lt;b&gt;&lt;u&gt;Remember to close the WebhookClient once you don't need it anymore to free
   * resources!&lt;/u&gt;&lt;/b&gt;
   *
   * @return The new WebhookClient instance
   */
  public WebhookClient build() {
<span class="nc" id="L182">    OkHttpClient client = this.client;</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">    if (client == null) {</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">      if (builder == null) builder = DEFAULT_HTTP_BUILDER;</span>
<span class="nc" id="L185">      client = builder.build();</span>
    }
<span class="nc bnc" id="L187" title="All 2 branches missed.">    if (pool == null) {</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">      if (threadFactory == null) threadFactory = new DefaultWebhookThreadFactory();</span>
<span class="nc" id="L189">      pool = Executors.newSingleThreadScheduledExecutor(threadFactory);</span>
    }
<span class="nc" id="L191">    return new WebhookClient(id, token, client, pool);</span>
  }

<span class="nc" id="L194">  public final class DefaultWebhookThreadFactory implements ThreadFactory {</span>
    @Override
    public Thread newThread(Runnable r) {
<span class="nc" id="L197">      final Thread thread = new Thread(r, &quot;Webhook-RateLimit Thread WebhookID: &quot; + id);</span>
<span class="nc" id="L198">      thread.setDaemon(isDaemon);</span>
<span class="nc" id="L199">      return thread;</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>