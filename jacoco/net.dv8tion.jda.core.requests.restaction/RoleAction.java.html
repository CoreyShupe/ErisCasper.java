<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RoleAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ErisCasper.java</a> &gt; <a href="index.source.html" class="el_package">net.dv8tion.jda.core.requests.restaction</a> &gt; <span class="el_source">RoleAction.java</span></div><h1>RoleAction.java</h1><pre class="source lang-java linenums">/*
 *     Copyright 2015-2018 Austin Keener &amp; Michael Ritter &amp; Florian Spieß
 *     Copyright 2018-2018 &quot;Princess&quot; Lana Samson
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package net.dv8tion.jda.core.requests.restaction;

import java.awt.Color;
import java.util.Collection;
import java.util.function.BooleanSupplier;
import net.dv8tion.jda.core.Permission;
import net.dv8tion.jda.core.entities.Guild;
import net.dv8tion.jda.core.entities.Role;
import net.dv8tion.jda.core.exceptions.InsufficientPermissionException;
import net.dv8tion.jda.core.requests.Request;
import net.dv8tion.jda.core.requests.Response;
import net.dv8tion.jda.core.requests.Route;
import net.dv8tion.jda.core.utils.Checks;
import okhttp3.RequestBody;
import org.json.JSONObject;

/**
 * Extension of {@link net.dv8tion.jda.core.requests.RestAction RestAction} specifically designed to
 * create a {@link net.dv8tion.jda.core.entities.Role Role}. This extension allows setting
 * properties before executing the action.
 *
 * @since 3.0
 * @author Florian Spieß
 */
public class RoleAction extends AuditableRestAction&lt;Role&gt; {

  protected final Guild guild;
  protected Long permissions;
<span class="nc" id="L45">  protected String name = null;</span>
<span class="nc" id="L46">  protected Integer color = null;</span>
<span class="nc" id="L47">  protected Boolean hoisted = null;</span>
<span class="nc" id="L48">  protected Boolean mentionable = null;</span>

  /**
   * Creates a new RoleAction instance
   *
   * @param route A {@link net.dv8tion.jda.core.requests.Route.CompiledRoute CompiledRoute} Which
   *     will be used for the Role creation.
   * @param guild The {@link net.dv8tion.jda.core.entities.Guild Guild} for which the Role should be
   *     created.
   */
  public RoleAction(Route.CompiledRoute route, Guild guild) {
<span class="nc" id="L59">    super(guild.getJDA(), route);</span>
<span class="nc" id="L60">    this.guild = guild;</span>
<span class="nc" id="L61">  }</span>

  @Override
  public RoleAction setCheck(BooleanSupplier checks) {
<span class="nc" id="L65">    return (RoleAction) super.setCheck(checks);</span>
  }

  /**
   * Sets the name for new role (optional)
   *
   * @param name The name for the new role, null to use default name
   * @return The current RoleAction, for chaining convenience
   */
  public RoleAction setName(String name) {
<span class="nc" id="L75">    this.name = name;</span>
<span class="nc" id="L76">    return this;</span>
  }

  /**
   * Sets whether or not the new role should be hoisted
   *
   * @param hoisted Whether the new role should be hoisted (grouped). Default is {@code false}
   * @return The current RoleAction, for chaining convenience
   */
  public RoleAction setHoisted(Boolean hoisted) {
<span class="nc" id="L86">    this.hoisted = hoisted;</span>
<span class="nc" id="L87">    return this;</span>
  }

  /**
   * Sets whether the new role should be mentionable by members of the parent {@link
   * net.dv8tion.jda.core.entities.Guild Guild}.
   *
   * @param mentionable Whether the new role should be mentionable. Default is {@code false}
   * @return The current RoleAction, for chaining convenience
   */
  public RoleAction setMentionable(Boolean mentionable) {
<span class="nc" id="L98">    this.mentionable = mentionable;</span>
<span class="nc" id="L99">    return this;</span>
  }

  /**
   * Sets the color which the new role should be displayed with.
   *
   * @param color An {@link java.awt.Color Color} for the new role, null to use default white/black
   * @return The current RoleAction, for chaining convenience
   */
  public RoleAction setColor(Color color) {
<span class="nc bnc" id="L109" title="All 2 branches missed.">    return this.setColor(color != null ? color.getRGB() : null);</span>
  }

  /**
   * Sets the Color for the new role. This accepts colors from the range {@code 0x000} to {@code
   * 0xFFFFFF}. The provided value will be ranged using {@code rbg &amp; 0xFFFFFF}
   *
   * @param rgb The color for the new role in integer form, {@code null} to use default white/black
   * @return The current RoleAction, for chaining convenience
   */
  public RoleAction setColor(Integer rgb) {
<span class="nc" id="L120">    this.color = rgb;</span>
<span class="nc" id="L121">    return this;</span>
  }

  /**
   * Sets the Permissions the new Role should have. This will only allow permissions that the
   * current account already holds unless the account is owner or {@link
   * net.dv8tion.jda.core.Permission#ADMINISTRATOR admin} of the parent {@link
   * net.dv8tion.jda.core.entities.Guild Guild}.
   *
   * @param permissions The varargs {@link net.dv8tion.jda.core.Permission Permissions} for the new
   *     role
   * @throws net.dv8tion.jda.core.exceptions.InsufficientPermissionException If the currently logged
   *     in account does not hold one of the specified permissions
   * @throws IllegalArgumentException If any of the provided permissions is {@code null}
   * @return The current RoleAction, for chaining convenience
   */
  public RoleAction setPermissions(Permission... permissions) {
<span class="nc bnc" id="L138" title="All 2 branches missed.">    if (permissions != null) {</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">      for (Permission p : permissions) {</span>
<span class="nc" id="L140">        Checks.notNull(p, &quot;Permissions&quot;);</span>
<span class="nc" id="L141">        checkPermission(p);</span>
      }
    }

<span class="nc bnc" id="L145" title="All 2 branches missed.">    this.permissions = permissions == null ? null : Permission.getRaw(permissions);</span>
<span class="nc" id="L146">    return this;</span>
  }

  /**
   * Sets the Permissions the new Role should have. This will only allow permissions that the
   * current account already holds unless the account is owner or {@link
   * net.dv8tion.jda.core.Permission#ADMINISTRATOR admin} of the parent {@link
   * net.dv8tion.jda.core.entities.Guild Guild}.
   *
   * @param permissions A {@link java.util.Collection Collection} of {@link
   *     net.dv8tion.jda.core.Permission Permissions} for the new role
   * @throws net.dv8tion.jda.core.exceptions.InsufficientPermissionException If the currently logged
   *     in account does not hold one of the specified permissions
   * @throws IllegalArgumentException If any of the provided permissions is {@code null}
   * @return The current RoleAction, for chaining convenience
   */
  public RoleAction setPermissions(Collection&lt;Permission&gt; permissions) {
<span class="nc bnc" id="L163" title="All 2 branches missed.">    if (permissions != null) {</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">      for (Permission p : permissions) {</span>
<span class="nc" id="L165">        Checks.notNull(p, &quot;Permissions&quot;);</span>
<span class="nc" id="L166">        checkPermission(p);</span>
<span class="nc" id="L167">      }</span>
    }

<span class="nc bnc" id="L170" title="All 2 branches missed.">    this.permissions = permissions == null ? null : Permission.getRaw(permissions);</span>
<span class="nc" id="L171">    return this;</span>
  }

  /**
   * Sets the Permissions the new Role should have. This will only allow permissions that the
   * current account already holds unless the account is owner or {@link
   * net.dv8tion.jda.core.Permission#ADMINISTRATOR admin} of the parent {@link
   * net.dv8tion.jda.core.entities.Guild Guild}.
   *
   * @param permissions The raw {@link net.dv8tion.jda.core.Permission Permissions} value for the
   *     new role. To retrieve this use {@link net.dv8tion.jda.core.Permission#getRawValue()}
   * @throws java.lang.IllegalArgumentException If the provided permission value is invalid
   * @throws net.dv8tion.jda.core.exceptions.InsufficientPermissionException If the currently logged
   *     in account does not hold one of the specified permissions
   * @return The current RoleAction, for chaining convenience
   * @see net.dv8tion.jda.core.Permission#getRawValue()
   * @see net.dv8tion.jda.core.Permission#getRaw(java.util.Collection)
   * @see net.dv8tion.jda.core.Permission#getRaw(net.dv8tion.jda.core.Permission...)
   */
  public RoleAction setPermissions(Long permissions) {
<span class="nc bnc" id="L191" title="All 2 branches missed.">    if (permissions != null) {</span>
<span class="nc" id="L192">      Checks.notNegative(permissions, &quot;Raw Permissions&quot;);</span>
<span class="nc" id="L193">      Checks.check(</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">          permissions &lt;= Permission.ALL_PERMISSIONS,</span>
          &quot;Provided permissions may not be greater than a full permission set!&quot;);
<span class="nc bnc" id="L196" title="All 2 branches missed.">      for (Permission p : Permission.getPermissions(permissions)) checkPermission(p);</span>
    }
<span class="nc" id="L198">    this.permissions = permissions;</span>
<span class="nc" id="L199">    return this;</span>
  }

  @Override
  protected RequestBody finalizeData() {
<span class="nc" id="L204">    JSONObject object = new JSONObject();</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">    if (name != null) object.put(&quot;name&quot;, name);</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">    if (color != null) object.put(&quot;color&quot;, color &amp; 0xFFFFFF);</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">    if (permissions != null) object.put(&quot;permissions&quot;, permissions);</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">    if (hoisted != null) object.put(&quot;hoist&quot;, hoisted.booleanValue());</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">    if (mentionable != null) object.put(&quot;mentionable&quot;, mentionable.booleanValue());</span>

<span class="nc" id="L211">    return getRequestBody(object);</span>
  }

  @Override
  protected void handleResponse(Response response, Request&lt;Role&gt; request) {
<span class="nc bnc" id="L216" title="All 2 branches missed.">    if (response.isOk())</span>
<span class="nc" id="L217">      request.onSuccess(api.getEntityBuilder().createRole(response.getObject(), guild.getIdLong()));</span>
<span class="nc" id="L218">    else request.onFailure(response);</span>
<span class="nc" id="L219">  }</span>

  private void checkPermission(Permission permission) {
<span class="nc bnc" id="L222" title="All 2 branches missed.">    if (!guild.getSelfMember().hasPermission(permission))</span>
<span class="nc" id="L223">      throw new InsufficientPermissionException(permission);</span>
<span class="nc" id="L224">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>