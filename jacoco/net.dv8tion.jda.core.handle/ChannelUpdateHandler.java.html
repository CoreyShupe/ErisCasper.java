<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ChannelUpdateHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ErisCasper.java</a> &gt; <a href="index.source.html" class="el_package">net.dv8tion.jda.core.handle</a> &gt; <span class="el_source">ChannelUpdateHandler.java</span></div><h1>ChannelUpdateHandler.java</h1><pre class="source lang-java linenums">/*
 *     Copyright 2015-2018 Austin Keener &amp; Michael Ritter &amp; Florian Spie√ü
 *     Copyright 2018-2018 &quot;Princess&quot; Lana Samson
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package net.dv8tion.jda.core.handle;

import gnu.trove.TDecorators;
import gnu.trove.list.TLongList;
import gnu.trove.list.linked.TLongLinkedList;
import gnu.trove.map.TLongObjectMap;
import java.util.ArrayList;
import java.util.List;
import java.util.Objects;
import net.dv8tion.jda.client.entities.impl.GroupImpl;
import net.dv8tion.jda.client.events.group.update.GroupUpdateIconEvent;
import net.dv8tion.jda.client.events.group.update.GroupUpdateNameEvent;
import net.dv8tion.jda.client.events.group.update.GroupUpdateOwnerEvent;
import net.dv8tion.jda.core.entities.*;
import net.dv8tion.jda.core.entities.impl.*;
import net.dv8tion.jda.core.events.channel.category.update.CategoryUpdateNameEvent;
import net.dv8tion.jda.core.events.channel.category.update.CategoryUpdatePermissionsEvent;
import net.dv8tion.jda.core.events.channel.category.update.CategoryUpdatePositionEvent;
import net.dv8tion.jda.core.events.channel.text.update.*;
import net.dv8tion.jda.core.events.channel.voice.update.*;
import net.dv8tion.jda.core.utils.Helpers;
import org.json.JSONArray;
import org.json.JSONObject;

public class ChannelUpdateHandler extends SocketHandler {
  public ChannelUpdateHandler(JDAImpl api) {
<span class="nc" id="L43">    super(api);</span>
<span class="nc" id="L44">  }</span>

  @Override
  protected Long handleInternally(JSONObject content) {
<span class="nc" id="L48">    ChannelType type = ChannelType.fromId(content.getInt(&quot;type&quot;));</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">    if (type == ChannelType.GROUP) {</span>
<span class="nc" id="L50">      handleGroup(content);</span>
<span class="nc" id="L51">      return null;</span>
    }

<span class="nc" id="L54">    List&lt;IPermissionHolder&gt; changed = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L55">    List&lt;IPermissionHolder&gt; contained = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L57">    final long channelId = content.getLong(&quot;id&quot;);</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">    final Long parentId = content.isNull(&quot;parent_id&quot;) ? null : content.getLong(&quot;parent_id&quot;);</span>
<span class="nc" id="L59">    final int position = content.getInt(&quot;position&quot;);</span>
<span class="nc" id="L60">    final String name = content.getString(&quot;name&quot;);</span>
<span class="nc" id="L61">    final boolean nsfw = Helpers.optBoolean(content, &quot;nsfw&quot;);</span>
<span class="nc" id="L62">    JSONArray permOverwrites = content.getJSONArray(&quot;permission_overwrites&quot;);</span>
<span class="nc bnc" id="L63" title="All 4 branches missed.">    switch (type) {</span>
      case TEXT:
        {
<span class="nc" id="L66">          String topic = content.optString(&quot;topic&quot;, null);</span>
<span class="nc" id="L67">          TextChannelImpl textChannel = (TextChannelImpl) api.getTextChannelMap().get(channelId);</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">          if (textChannel == null) {</span>
<span class="nc" id="L69">            api.getEventCache()</span>
<span class="nc" id="L70">                .cache(</span>
<span class="nc" id="L71">                    EventCache.Type.CHANNEL, channelId, () -&gt; handle(responseNumber, allContent));</span>
<span class="nc" id="L72">            EventCache.LOG.debug(</span>
                &quot;CHANNEL_UPDATE attempted to update a TextChannel that does not exist. JSON: {}&quot;,
                content);
<span class="nc" id="L75">            return null;</span>
          }

          // If any properties changed, update the values and fire the proper events.
<span class="nc" id="L79">          final Category parent = textChannel.getParent();</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">          final Long oldParent = parent == null ? null : parent.getIdLong();</span>
<span class="nc" id="L81">          final String oldName = textChannel.getName();</span>
<span class="nc" id="L82">          final String oldTopic = textChannel.getTopic();</span>
<span class="nc" id="L83">          final int oldPosition = textChannel.getPositionRaw();</span>
<span class="nc" id="L84">          final boolean oldNsfw = textChannel.isNSFW();</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">          if (!Objects.equals(oldName, name)) {</span>
<span class="nc" id="L86">            textChannel.setName(name);</span>
<span class="nc" id="L87">            api.getEventManager()</span>
<span class="nc" id="L88">                .handle(</span>
                    new TextChannelUpdateNameEvent(
                        api, responseNumber,
                        textChannel, oldName));
          }
<span class="nc bnc" id="L93" title="All 2 branches missed.">          if (!Objects.equals(oldParent, parentId)) {</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">            textChannel.setParent(parentId == null ? 0 : parentId);</span>
<span class="nc" id="L95">            api.getEventManager()</span>
<span class="nc" id="L96">                .handle(</span>
                    new TextChannelUpdateParentEvent(
                        api, responseNumber,
                        textChannel, parent));
          }
<span class="nc bnc" id="L101" title="All 2 branches missed.">          if (!Objects.equals(oldTopic, topic)) {</span>
<span class="nc" id="L102">            textChannel.setTopic(topic);</span>
<span class="nc" id="L103">            api.getEventManager()</span>
<span class="nc" id="L104">                .handle(</span>
                    new TextChannelUpdateTopicEvent(
                        api, responseNumber,
                        textChannel, oldTopic));
          }
<span class="nc bnc" id="L109" title="All 2 branches missed.">          if (oldPosition != position) {</span>
<span class="nc" id="L110">            textChannel.setRawPosition(position);</span>
<span class="nc" id="L111">            api.getEventManager()</span>
<span class="nc" id="L112">                .handle(</span>
                    new TextChannelUpdatePositionEvent(
                        api, responseNumber,
                        textChannel, oldPosition));
          }

<span class="nc bnc" id="L118" title="All 2 branches missed.">          if (oldNsfw != nsfw) {</span>
<span class="nc" id="L119">            textChannel.setNSFW(nsfw);</span>
<span class="nc" id="L120">            api.getEventManager()</span>
<span class="nc" id="L121">                .handle(</span>
                    new TextChannelUpdateNSFWEvent(
                        api, responseNumber,
                        textChannel, nsfw));
          }

<span class="nc" id="L127">          applyPermissions(textChannel, content, permOverwrites, contained, changed);</span>

          // If this update modified permissions in any way.
<span class="nc bnc" id="L130" title="All 2 branches missed.">          if (!changed.isEmpty()) {</span>
<span class="nc" id="L131">            api.getEventManager()</span>
<span class="nc" id="L132">                .handle(</span>
                    new TextChannelUpdatePermissionsEvent(
                        api, responseNumber,
                        textChannel, changed));
          }
          break; // Finish the TextChannelUpdate case
        }
      case VOICE:
        {
<span class="nc" id="L141">          VoiceChannelImpl voiceChannel =</span>
<span class="nc" id="L142">              (VoiceChannelImpl) api.getVoiceChannelMap().get(channelId);</span>
<span class="nc" id="L143">          int userLimit = content.getInt(&quot;user_limit&quot;);</span>
<span class="nc" id="L144">          int bitrate = content.getInt(&quot;bitrate&quot;);</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">          if (voiceChannel == null) {</span>
<span class="nc" id="L146">            api.getEventCache()</span>
<span class="nc" id="L147">                .cache(</span>
<span class="nc" id="L148">                    EventCache.Type.CHANNEL, channelId, () -&gt; handle(responseNumber, allContent));</span>
<span class="nc" id="L149">            EventCache.LOG.debug(</span>
                &quot;CHANNEL_UPDATE attempted to update a VoiceChannel that does not exist. JSON: {}&quot;,
                content);
<span class="nc" id="L152">            return null;</span>
          }
          // If any properties changed, update the values and fire the proper events.
<span class="nc" id="L155">          final Category parent = voiceChannel.getParent();</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">          final Long oldParent = parent == null ? null : parent.getIdLong();</span>
<span class="nc" id="L157">          final String oldName = voiceChannel.getName();</span>
<span class="nc" id="L158">          final int oldPosition = voiceChannel.getPositionRaw();</span>
<span class="nc" id="L159">          final int oldLimit = voiceChannel.getUserLimit();</span>
<span class="nc" id="L160">          final int oldBitrate = voiceChannel.getBitrate();</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">          if (!Objects.equals(oldName, name)) {</span>
<span class="nc" id="L162">            voiceChannel.setName(name);</span>
<span class="nc" id="L163">            api.getEventManager()</span>
<span class="nc" id="L164">                .handle(</span>
                    new VoiceChannelUpdateNameEvent(
                        api, responseNumber,
                        voiceChannel, oldName));
          }
<span class="nc bnc" id="L169" title="All 2 branches missed.">          if (!Objects.equals(oldParent, parentId)) {</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">            voiceChannel.setParent(parentId == null ? 0 : parentId);</span>
<span class="nc" id="L171">            api.getEventManager()</span>
<span class="nc" id="L172">                .handle(</span>
                    new VoiceChannelUpdateParentEvent(
                        api, responseNumber,
                        voiceChannel, parent));
          }
<span class="nc bnc" id="L177" title="All 2 branches missed.">          if (oldPosition != position) {</span>
<span class="nc" id="L178">            voiceChannel.setRawPosition(position);</span>
<span class="nc" id="L179">            api.getEventManager()</span>
<span class="nc" id="L180">                .handle(</span>
                    new VoiceChannelUpdatePositionEvent(
                        api, responseNumber,
                        voiceChannel, oldPosition));
          }
<span class="nc bnc" id="L185" title="All 2 branches missed.">          if (oldLimit != userLimit) {</span>
<span class="nc" id="L186">            voiceChannel.setUserLimit(userLimit);</span>
<span class="nc" id="L187">            api.getEventManager()</span>
<span class="nc" id="L188">                .handle(</span>
                    new VoiceChannelUpdateUserLimitEvent(
                        api, responseNumber,
                        voiceChannel, oldLimit));
          }
<span class="nc bnc" id="L193" title="All 2 branches missed.">          if (oldBitrate != bitrate) {</span>
<span class="nc" id="L194">            voiceChannel.setBitrate(bitrate);</span>
<span class="nc" id="L195">            api.getEventManager()</span>
<span class="nc" id="L196">                .handle(</span>
                    new VoiceChannelUpdateBitrateEvent(
                        api, responseNumber,
                        voiceChannel, oldBitrate));
          }

<span class="nc" id="L202">          applyPermissions(voiceChannel, content, permOverwrites, contained, changed);</span>

          // If this update modified permissions in any way.
<span class="nc bnc" id="L205" title="All 2 branches missed.">          if (!changed.isEmpty()) {</span>
<span class="nc" id="L206">            api.getEventManager()</span>
<span class="nc" id="L207">                .handle(</span>
                    new VoiceChannelUpdatePermissionsEvent(
                        api, responseNumber,
                        voiceChannel, changed));
          }
          break; // Finish the VoiceChannelUpdate case
        }
      case CATEGORY:
        {
<span class="nc" id="L216">          CategoryImpl category = (CategoryImpl) api.getCategoryById(channelId);</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">          if (category == null) {</span>
<span class="nc" id="L218">            api.getEventCache()</span>
<span class="nc" id="L219">                .cache(</span>
<span class="nc" id="L220">                    EventCache.Type.CHANNEL, channelId, () -&gt; handle(responseNumber, allContent));</span>
<span class="nc" id="L221">            EventCache.LOG.debug(</span>
                &quot;CHANNEL_UPDATE attempted to update a Category that does not exist. JSON: {}&quot;,
                content);
<span class="nc" id="L224">            return null;</span>
          }
<span class="nc" id="L226">          final String oldName = category.getName();</span>
<span class="nc" id="L227">          final int oldPosition = category.getPositionRaw();</span>

<span class="nc bnc" id="L229" title="All 2 branches missed.">          if (!Objects.equals(oldName, name)) {</span>
<span class="nc" id="L230">            category.setName(name);</span>
<span class="nc" id="L231">            api.getEventManager()</span>
<span class="nc" id="L232">                .handle(</span>
                    new CategoryUpdateNameEvent(
                        api, responseNumber,
                        category, oldName));
          }
<span class="nc bnc" id="L237" title="All 2 branches missed.">          if (!Objects.equals(oldPosition, position)) {</span>
<span class="nc" id="L238">            category.setRawPosition(position);</span>
<span class="nc" id="L239">            api.getEventManager()</span>
<span class="nc" id="L240">                .handle(</span>
                    new CategoryUpdatePositionEvent(
                        api, responseNumber,
                        category, oldPosition));
          }

<span class="nc" id="L246">          applyPermissions(category, content, permOverwrites, contained, changed);</span>
          // If this update modified permissions in any way.
<span class="nc bnc" id="L248" title="All 2 branches missed.">          if (!changed.isEmpty()) {</span>
<span class="nc" id="L249">            api.getEventManager()</span>
<span class="nc" id="L250">                .handle(</span>
                    new CategoryUpdatePermissionsEvent(
                        api, responseNumber,
                        category, changed));
          }
          break; // Finish the CategoryUpdate case
        }
      default:
<span class="nc" id="L258">        throw new IllegalArgumentException(</span>
            &quot;CHANNEL_UPDATE provided an unrecognized channel type JSON: &quot; + content);
    }
<span class="nc" id="L261">    return null;</span>
  }

  private long getIdLong(IPermissionHolder permHolder) {
<span class="nc bnc" id="L265" title="All 2 branches missed.">    if (permHolder instanceof Member) return ((Member) permHolder).getUser().getIdLong();</span>
<span class="nc" id="L266">    else return ((Role) permHolder).getIdLong();</span>
  }

  private void applyPermissions(
      AbstractChannelImpl&lt;?&gt; channel,
      JSONObject content,
      JSONArray permOverwrites,
      List&lt;IPermissionHolder&gt; contained,
      List&lt;IPermissionHolder&gt; changed) {

    // Determines if a new PermissionOverride was created or updated.
    // If a PermissionOverride was created or updated it stores it in the proper Map to be reported
    // by the Event.
<span class="nc bnc" id="L279" title="All 2 branches missed.">    for (int i = 0; i &lt; permOverwrites.length(); i++) {</span>
<span class="nc" id="L280">      handlePermissionOverride(</span>
<span class="nc" id="L281">          permOverwrites.getJSONObject(i), channel, content, changed, contained);</span>
    }

    // Check if any overrides were deleted because of this event.
    // Get the current overrides. (we copy them to a new list because the Set returned is backed by
    // the Map, meaning our removes would remove from the Map. Not good.
    // Loop through all of the json defined overrides. If we find a match, remove the User or Role
    // from our lists.
    // Any entries remaining in these lists after this for loop is over will be removed from the
    // Channel's overrides.
<span class="nc" id="L291">    final TLongList toRemove = new TLongLinkedList();</span>
<span class="nc" id="L292">    final TLongObjectMap&lt;PermissionOverride&gt; overridesMap = channel.getOverrideMap();</span>

<span class="nc" id="L294">    TDecorators.wrap(overridesMap.keySet())</span>
<span class="nc" id="L295">        .stream()</span>
<span class="nc" id="L296">        .map(id -&gt; mapPermissionHolder(id, channel.getGuild()))</span>
<span class="nc" id="L297">        .filter(Objects::nonNull)</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">        .filter(permHolder -&gt; !contained.contains(permHolder))</span>
<span class="nc" id="L299">        .forEach(</span>
            permHolder -&gt; {
<span class="nc" id="L301">              changed.add(permHolder);</span>
<span class="nc" id="L302">              toRemove.add(getIdLong(permHolder));</span>
<span class="nc" id="L303">            });</span>

<span class="nc" id="L305">    toRemove.forEach(</span>
        (id) -&gt; {
<span class="nc" id="L307">          overridesMap.remove(id);</span>
<span class="nc" id="L308">          return true;</span>
        });
<span class="nc" id="L310">  }</span>

  private IPermissionHolder mapPermissionHolder(long id, Guild guild) {
<span class="nc" id="L313">    final Role holder = guild.getRoleById(id);</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">    return holder == null ? guild.getMemberById(id) : holder;</span>
  }

  private void handlePermissionOverride(
      JSONObject override,
      AbstractChannelImpl&lt;?&gt; channel,
      JSONObject content,
      List&lt;IPermissionHolder&gt; changedPermHolders,
      List&lt;IPermissionHolder&gt; containedPermHolders) {
<span class="nc" id="L323">    final long id = override.getLong(&quot;id&quot;);</span>
<span class="nc" id="L324">    final long allow = override.getLong(&quot;allow&quot;);</span>
<span class="nc" id="L325">    final long deny = override.getLong(&quot;deny&quot;);</span>
    final IPermissionHolder permHolder;

<span class="nc bnc" id="L328" title="All 10 branches missed.">    switch (override.getString(&quot;type&quot;)) {</span>
      case &quot;role&quot;:
        {
<span class="nc" id="L331">          permHolder = channel.getGuild().getRoleById(id);</span>

<span class="nc bnc" id="L333" title="All 2 branches missed.">          if (permHolder == null) {</span>
<span class="nc" id="L334">            api.getEventCache()</span>
<span class="nc" id="L335">                .cache(</span>
                    EventCache.Type.ROLE,
                    id,
                    () -&gt;
<span class="nc" id="L339">                        handlePermissionOverride(</span>
                            override, channel, content, changedPermHolders, containedPermHolders));
<span class="nc" id="L341">            EventCache.LOG.debug(</span>
                &quot;CHANNEL_UPDATE attempted to create or update a PermissionOverride for a Role that doesn't exist! RoleId: {} JSON: {}&quot;,
<span class="nc" id="L343">                id,</span>
                content);
<span class="nc" id="L345">            return;</span>
          }
          break;
        }
      case &quot;member&quot;:
        {
<span class="nc" id="L351">          permHolder = channel.getGuild().getMemberById(id);</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">          if (permHolder == null) {</span>
<span class="nc" id="L353">            api.getEventCache()</span>
<span class="nc" id="L354">                .cache(</span>
                    EventCache.Type.USER,
                    id,
                    () -&gt;
<span class="nc" id="L358">                        handlePermissionOverride(</span>
                            override, channel, content, changedPermHolders, containedPermHolders));
<span class="nc" id="L360">            EventCache.LOG.debug(</span>
                &quot;CHANNEL_UPDATE attempted to create or update a PermissionOverride for Member that doesn't exist in this Guild! MemberId: {} JSON: {}&quot;,
<span class="nc" id="L362">                id,</span>
                content);
<span class="nc" id="L364">            return;</span>
          }
          break;
        }
      default:
<span class="nc" id="L369">        throw new IllegalArgumentException(</span>
            &quot;CHANNEL_UPDATE provided an unrecognized PermissionOverride type. JSON: &quot; + content);
    }

<span class="nc" id="L373">    PermissionOverrideImpl permOverride = (PermissionOverrideImpl) channel.getOverrideMap().get(id);</span>

<span class="nc bnc" id="L375" title="All 2 branches missed.">    if (permOverride == null) // Created</span>
    {
<span class="nc" id="L377">      api.getEntityBuilder().createPermissionOverride(override, channel);</span>
<span class="nc" id="L378">      changedPermHolders.add(permHolder);</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">    } else if (permOverride.getAllowedRaw() != allow</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">        || permOverride.getDeniedRaw() != deny) // Updated</span>
    {
<span class="nc" id="L382">      permOverride.setAllow(allow);</span>
<span class="nc" id="L383">      permOverride.setDeny(deny);</span>
<span class="nc" id="L384">      changedPermHolders.add(permHolder);</span>
    }
<span class="nc" id="L386">    containedPermHolders.add(permHolder);</span>
<span class="nc" id="L387">  }</span>

  private void handleGroup(JSONObject content) {
<span class="nc" id="L390">    final long groupId = content.getLong(&quot;id&quot;);</span>
<span class="nc" id="L391">    final long ownerId = content.getLong(&quot;owner_id&quot;);</span>
<span class="nc" id="L392">    final String name = content.optString(&quot;name&quot;, null);</span>
<span class="nc" id="L393">    final String iconId = content.optString(&quot;icon&quot;, null);</span>

<span class="nc" id="L395">    GroupImpl group = (GroupImpl) api.asClient().getGroupById(groupId);</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">    if (group == null) {</span>
<span class="nc" id="L397">      api.getEventCache()</span>
<span class="nc" id="L398">          .cache(EventCache.Type.CHANNEL, groupId, () -&gt; handle(responseNumber, allContent));</span>
<span class="nc" id="L399">      EventCache.LOG.debug(</span>
          &quot;Received CHANNEL_UPDATE for a group that was not yet cached. JSON: {}&quot;, content);
<span class="nc" id="L401">      return;</span>
    }

<span class="nc" id="L404">    final User owner = group.getUserMap().get(ownerId);</span>
<span class="nc" id="L405">    final User oldOwner = group.getOwner();</span>
<span class="nc" id="L406">    final String oldName = group.getName();</span>
<span class="nc" id="L407">    final String oldIconId = group.getIconId();</span>

<span class="nc bnc" id="L409" title="All 2 branches missed.">    if (owner == null) {</span>
<span class="nc" id="L410">      EventCache.LOG.warn(</span>
          &quot;Received CHANNEL_UPDATE for a group with an owner_id for a user that is not cached. owner_id: {}&quot;,
<span class="nc" id="L412">          ownerId);</span>
    } else {
<span class="nc bnc" id="L414" title="All 2 branches missed.">      if (!Objects.equals(owner, oldOwner)) {</span>
<span class="nc" id="L415">        group.setOwner(owner);</span>
<span class="nc" id="L416">        api.getEventManager()</span>
<span class="nc" id="L417">            .handle(</span>
                new GroupUpdateOwnerEvent(
                    api, responseNumber,
                    group, oldOwner));
      }
    }

<span class="nc bnc" id="L424" title="All 2 branches missed.">    if (!Objects.equals(name, oldName)) {</span>
<span class="nc" id="L425">      group.setName(name);</span>
<span class="nc" id="L426">      api.getEventManager()</span>
<span class="nc" id="L427">          .handle(</span>
              new GroupUpdateNameEvent(
                  api, responseNumber,
                  group, oldName));
    }
<span class="nc bnc" id="L432" title="All 2 branches missed.">    if (!Objects.equals(iconId, oldIconId)) {</span>
<span class="nc" id="L433">      group.setIconId(iconId);</span>
<span class="nc" id="L434">      api.getEventManager()</span>
<span class="nc" id="L435">          .handle(</span>
              new GroupUpdateIconEvent(
                  api, responseNumber,
                  group, oldIconId));
    }
<span class="nc" id="L440">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>