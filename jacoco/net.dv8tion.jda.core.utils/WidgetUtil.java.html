<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WidgetUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ErisCasper.java</a> &gt; <a href="index.source.html" class="el_package">net.dv8tion.jda.core.utils</a> &gt; <span class="el_source">WidgetUtil.java</span></div><h1>WidgetUtil.java</h1><pre class="source lang-java linenums">/*
 *     Copyright 2015-2018 Austin Keener &amp; Michael Ritter &amp; Florian Spie√ü
 *     Copyright 2018-2018 &quot;Princess&quot; Lana Samson
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package net.dv8tion.jda.core.utils;

import gnu.trove.map.TLongObjectMap;
import gnu.trove.map.hash.TLongObjectHashMap;
import java.io.IOException;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import net.dv8tion.jda.core.OnlineStatus;
import net.dv8tion.jda.core.entities.*;
import net.dv8tion.jda.core.entities.impl.UserImpl;
import net.dv8tion.jda.core.exceptions.RateLimitedException;
import net.dv8tion.jda.core.requests.Requester;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;
import org.json.JSONArray;
import org.json.JSONObject;
import org.json.JSONTokener;

/**
 * The WidgetUtil is a class for interacting with various facets of Discord's guild widgets
 *
 * @since 3.0
 * @author John A. Grosh
 */
<span class="nc" id="L45">public class WidgetUtil {</span>
<span class="nc" id="L46">  public static final String WIDGET_PNG =</span>
      Requester.DISCORD_API_PREFIX + &quot;guilds/%s/widget.png?style=%s&quot;;
<span class="nc" id="L48">  public static final String WIDGET_URL = Requester.DISCORD_API_PREFIX + &quot;guilds/%s/widget.json&quot;;</span>
  public static final String WIDGET_HTML =
      &quot;&lt;iframe src=\&quot;https://discordapp.com/widget?id=%s&amp;theme=%s\&quot; width=\&quot;%d\&quot; height=\&quot;%d\&quot; allowtransparency=\&quot;true\&quot; frameborder=\&quot;0\&quot;&gt;&lt;/iframe&gt;&quot;;

  /**
   * Gets the banner image for the specified guild of the specified type. &lt;br&gt;
   * This banner will only be available if the guild in question has the Widget enabled.
   *
   * @param guild The guild
   * @param type The type (visual style) of the banner
   * @return A String containing the URL of the banner image
   */
  public static String getWidgetBanner(Guild guild, BannerType type) {
<span class="nc" id="L61">    Checks.notNull(guild, &quot;Guild&quot;);</span>
<span class="nc" id="L62">    return getWidgetBanner(guild.getId(), type);</span>
  }

  /**
   * Gets the banner image for the specified guild of the specified type. &lt;br&gt;
   * This banner will only be available if the guild in question has the Widget enabled.
   * Additionally, this method can be used independently of being on the guild in question.
   *
   * @param guildId the guild ID
   * @param type The type (visual style) of the banner
   * @return A String containing the URL of the banner image
   */
  public static String getWidgetBanner(String guildId, BannerType type) {
<span class="nc" id="L75">    Checks.notNull(guildId, &quot;GuildId&quot;);</span>
<span class="nc" id="L76">    Checks.notNull(type, &quot;BannerType&quot;);</span>
<span class="nc" id="L77">    return String.format(WIDGET_PNG, guildId, type.name().toLowerCase());</span>
  }

  /**
   * Gets the pre-made HTML Widget for the specified guild using the specified settings. The widget
   * will only display correctly if the guild in question has the Widget enabled.
   *
   * @param guild the guild
   * @param theme the theme, light or dark
   * @param width the width of the widget
   * @param height the height of the widget
   * @return a String containing the pre-made widget with the supplied settings
   */
  public static String getPremadeWidgetHtml(Guild guild, WidgetTheme theme, int width, int height) {
<span class="nc" id="L91">    Checks.notNull(guild, &quot;Guild&quot;);</span>
<span class="nc" id="L92">    return getPremadeWidgetHtml(guild.getId(), theme, width, height);</span>
  }

  /**
   * Gets the pre-made HTML Widget for the specified guild using the specified settings. The widget
   * will only display correctly if the guild in question has the Widget enabled. Additionally, this
   * method can be used independently of being on the guild in question.
   *
   * @param guildId the guild ID
   * @param theme the theme, light or dark
   * @param width the width of the widget
   * @param height the height of the widget
   * @return a String containing the pre-made widget with the supplied settings
   */
  public static String getPremadeWidgetHtml(
      String guildId, WidgetTheme theme, int width, int height) {
<span class="nc" id="L108">    Checks.notNull(guildId, &quot;GuildId&quot;);</span>
<span class="nc" id="L109">    Checks.notNull(theme, &quot;WidgetTheme&quot;);</span>
<span class="nc" id="L110">    Checks.notNegative(width, &quot;Width&quot;);</span>
<span class="nc" id="L111">    Checks.notNegative(height, &quot;Height&quot;);</span>
<span class="nc" id="L112">    return String.format(WIDGET_HTML, guildId, theme.name().toLowerCase(), width, height);</span>
  }

  /**
   * Makes a GET request to get the information for a Guild's widget. This widget (if available)
   * contains information about the guild, including the Guild's name, an invite code (if set), a
   * list of voice channels, and a list of online members (plus the voice states of any members in
   * voice channels).
   *
   * &lt;p&gt;This Widget can be obtained from any valid guild ID that has it enabled; no accounts need to
   * be on the server to access this information.
   *
   * @param guildId The id of the Guild
   * @throws net.dv8tion.jda.core.exceptions.RateLimitedException If the request was rate limited,
   *     &lt;b&gt;respect the timeout&lt;/b&gt;!
   * @throws java.lang.NumberFormatException If the provided {@code guildId} cannot be parsed by
   *     {@link Long#parseLong(String)}
   * @return {@code null} if the provided guild ID is not a valid Discord guild ID &lt;br&gt;
   *     a Widget object with null fields and isAvailable() returning false if the guild ID is valid
   *     but the guild in question does not have the widget enabled &lt;br&gt;
   *     a filled-in Widget object if the guild ID is valid and the guild in question has the widget
   *     enabled.
   */
  public static Widget getWidget(String guildId) throws RateLimitedException {
<span class="nc" id="L136">    return getWidget(MiscUtil.parseSnowflake(guildId));</span>
  }

  /**
   * Makes a GET request to get the information for a Guild's widget. This widget (if available)
   * contains information about the guild, including the Guild's name, an invite code (if set), a
   * list of voice channels, and a list of online members (plus the voice states of any members in
   * voice channels).
   *
   * &lt;p&gt;This Widget can be obtained from any valid guild ID that has it enabled; no accounts need to
   * be on the server to access this information.
   *
   * @param guildId The id of the Guild
   * @throws net.dv8tion.jda.core.exceptions.RateLimitedException If the request was rate limited,
   *     &lt;b&gt;respect the timeout&lt;/b&gt;!
   * @return {@code null} if the provided guild ID is not a valid Discord guild ID &lt;br&gt;
   *     a Widget object with null fields and isAvailable() returning false if the guild ID is valid
   *     but the guild in question does not have the widget enabled &lt;br&gt;
   *     a filled-in Widget object if the guild ID is valid and the guild in question has the widget
   *     enabled.
   */
  public static Widget getWidget(long guildId) throws RateLimitedException {
<span class="nc" id="L158">    Checks.notNull(guildId, &quot;GuildId&quot;);</span>

    HttpURLConnection connection;
<span class="nc" id="L161">    OkHttpClient client = new OkHttpClient.Builder().build();</span>
<span class="nc" id="L162">    Request request =</span>
        new Request.Builder()
<span class="nc" id="L164">            .url(String.format(WIDGET_URL, guildId))</span>
<span class="nc" id="L165">            .method(&quot;GET&quot;, null)</span>
<span class="nc" id="L166">            .header(&quot;user-agent&quot;, Requester.USER_AGENT)</span>
<span class="nc" id="L167">            .header(&quot;accept-encoding&quot;, &quot;gzip&quot;)</span>
<span class="nc" id="L168">            .build();</span>

<span class="nc" id="L170">    try (Response response = client.newCall(request).execute()) {</span>
<span class="nc" id="L171">      final int code = response.code();</span>
<span class="nc" id="L172">      InputStream data = Requester.getBody(response);</span>

<span class="nc bnc" id="L174" title="All 5 branches missed.">      switch (code) {</span>
        case 200: // ok
          {
<span class="nc" id="L177">            try (InputStream stream = data) {</span>
<span class="nc" id="L178">              return new Widget(new JSONObject(new JSONTokener(stream)));</span>
<span class="nc" id="L179">            } catch (IOException e) {</span>
<span class="nc" id="L180">              throw new IllegalStateException(e);</span>
            }
          }
        case 400: // not valid snowflake
        case 404: // guild not found
<span class="nc" id="L185">          return null;</span>
        case 403: // widget disabled
<span class="nc" id="L187">          return new Widget(guildId);</span>
        case 429: // ratelimited
          {
            long retryAfter;
<span class="nc" id="L191">            try (InputStream stream = data) {</span>
<span class="nc" id="L192">              retryAfter = new JSONObject(new JSONTokener(stream)).getLong(&quot;retry_after&quot;);</span>
<span class="nc" id="L193">            } catch (Exception e) {</span>
<span class="nc" id="L194">              retryAfter = 0;</span>
<span class="nc" id="L195">            }</span>
<span class="nc" id="L196">            throw new RateLimitedException(WIDGET_URL, retryAfter);</span>
          }
        default:
<span class="nc" id="L199">          throw new IllegalStateException(</span>
<span class="nc" id="L200">              &quot;An unknown status was returned: &quot; + code + &quot; &quot; + response.message());</span>
      }
<span class="nc" id="L202">    } catch (IOException e) {</span>
<span class="nc" id="L203">      throw new IllegalStateException(e);</span>
    }
  }

  /**
   * Represents the available banner types &lt;br&gt;
   * Each of these has a different appearance:
   *
   * &lt;p&gt;&lt;br&gt;
   * &lt;b&gt;Shield&lt;/b&gt; - tiny, only contains Discord logo and online count &lt;br&gt;
   * &lt;b&gt;Banner1&lt;/b&gt; - medium, contains server name, icon, and online count, and a &quot;Powered by
   * Discord&quot; bar on the bottom &lt;br&gt;
   * &lt;b&gt;Banner2&lt;/b&gt; - small, contains server name, icon, and online count, and a Discord logo on the
   * side &lt;br&gt;
   * &lt;b&gt;Banner3&lt;/b&gt; - medium, contains server name, icon, and online count, and a Discord logo with
   * a &quot;Chat Now&quot; bar on the bottom &lt;br&gt;
   * &lt;b&gt;Banner4&lt;/b&gt; - large, contains a very big Discord logo, server name, icon, and online count,
   * and a big &quot;Join My Server&quot; button
   */
<span class="nc" id="L222">  public enum BannerType {</span>
<span class="nc" id="L223">    SHIELD,</span>
<span class="nc" id="L224">    BANNER1,</span>
<span class="nc" id="L225">    BANNER2,</span>
<span class="nc" id="L226">    BANNER3,</span>
<span class="nc" id="L227">    BANNER4</span>
  }

  /**
   * Represents the color scheme of the widget &lt;br&gt;
   * These color themes match Discord's dark and light themes
   */
<span class="nc" id="L234">  public enum WidgetTheme {</span>
<span class="nc" id="L235">    LIGHT,</span>
<span class="nc" id="L236">    DARK</span>
  }

  public static class Widget implements ISnowflake {
    private final boolean isAvailable;
    private final long id;
    private final String name;
    private final String invite;
    private final TLongObjectMap&lt;VoiceChannel&gt; channels;
    private final TLongObjectMap&lt;Member&gt; members;

    /** Constructs an unavailable Widget */
<span class="nc" id="L248">    private Widget(long guildId) {</span>
<span class="nc" id="L249">      isAvailable = false;</span>
<span class="nc" id="L250">      id = guildId;</span>
<span class="nc" id="L251">      name = null;</span>
<span class="nc" id="L252">      invite = null;</span>
<span class="nc" id="L253">      channels = new TLongObjectHashMap&lt;&gt;();</span>
<span class="nc" id="L254">      members = new TLongObjectHashMap&lt;&gt;();</span>
<span class="nc" id="L255">    }</span>

    /**
     * Constructs an available Widget
     *
     * @param json The {@link org.json.JSONObject JSONObject} to construct the Widget from
     */
<span class="nc" id="L262">    private Widget(JSONObject json) {</span>
<span class="nc" id="L263">      String inviteCode = json.optString(&quot;instant_invite&quot;, null);</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">      if (inviteCode != null) inviteCode = inviteCode.substring(inviteCode.lastIndexOf(&quot;/&quot;) + 1);</span>

<span class="nc" id="L266">      isAvailable = true;</span>
<span class="nc" id="L267">      id = json.getLong(&quot;id&quot;);</span>
<span class="nc" id="L268">      name = json.getString(&quot;name&quot;);</span>
<span class="nc" id="L269">      invite = inviteCode;</span>
<span class="nc" id="L270">      channels = MiscUtil.newLongMap();</span>
<span class="nc" id="L271">      members = MiscUtil.newLongMap();</span>

<span class="nc" id="L273">      JSONArray channelsJson = json.getJSONArray(&quot;channels&quot;);</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">      for (int i = 0; i &lt; channelsJson.length(); i++) {</span>
<span class="nc" id="L275">        JSONObject channel = channelsJson.getJSONObject(i);</span>
<span class="nc" id="L276">        channels.put(channel.getLong(&quot;id&quot;), new VoiceChannel(channel, this));</span>
      }

<span class="nc" id="L279">      JSONArray membersJson = json.getJSONArray(&quot;members&quot;);</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">      for (int i = 0; i &lt; membersJson.length(); i++) {</span>
<span class="nc" id="L281">        JSONObject memberJson = membersJson.getJSONObject(i);</span>
<span class="nc" id="L282">        Member member = new Member(memberJson, this);</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (!memberJson.isNull(&quot;channel_id&quot;)) // voice state</span>
        {
<span class="nc" id="L285">          VoiceChannel channel = channels.get(memberJson.getLong(&quot;channel_id&quot;));</span>
<span class="nc" id="L286">          member.setVoiceState(</span>
              new VoiceState(
                  channel,
<span class="nc" id="L289">                  memberJson.getBoolean(&quot;mute&quot;),</span>
<span class="nc" id="L290">                  memberJson.getBoolean(&quot;deaf&quot;),</span>
<span class="nc" id="L291">                  memberJson.getBoolean(&quot;suppress&quot;),</span>
<span class="nc" id="L292">                  memberJson.getBoolean(&quot;self_mute&quot;),</span>
<span class="nc" id="L293">                  memberJson.getBoolean(&quot;self_deaf&quot;),</span>
                  member,
                  this));
<span class="nc" id="L296">          channel.addMember(member);</span>
        }
<span class="nc" id="L298">        members.put(member.getIdLong(), member);</span>
      }
<span class="nc" id="L300">    }</span>

    /**
     * Shows whether or not the widget for a guild is available. If this method returns false, all
     * other values will be null
     *
     * @return True, if the widget is available, false otherwise
     */
    public boolean isAvailable() {
<span class="nc" id="L309">      return isAvailable;</span>
    }

    @Override
    public long getIdLong() {
<span class="nc" id="L314">      return id;</span>
    }

    /**
     * Gets the name of the guild
     *
     * @throws IllegalStateException If the widget is not {@link #isAvailable() available}
     * @return the name of the guild
     */
    public String getName() {
<span class="nc" id="L324">      checkAvailable();</span>

<span class="nc" id="L326">      return name;</span>
    }

    /**
     * Gets an invite code for the guild, or null if no invite channel is enabled in the widget
     *
     * @throws IllegalStateException If the widget is not {@link #isAvailable() available}
     * @return an invite code for the guild, if widget invites are enabled
     */
    public String getInviteCode() {
<span class="nc" id="L336">      checkAvailable();</span>

<span class="nc" id="L338">      return invite;</span>
    }

    /**
     * Gets the list of voice channels in the guild
     *
     * @throws IllegalStateException If the widget is not {@link #isAvailable() available}
     * @return the list of voice channels in the guild
     */
    public List&lt;VoiceChannel&gt; getVoiceChannels() {
<span class="nc" id="L348">      checkAvailable();</span>

<span class="nc" id="L350">      return Collections.unmodifiableList(new ArrayList&lt;&gt;(channels.valueCollection()));</span>
    }

    /**
     * Gets a voice channel with the given ID, or null if the voice channel is not found
     *
     * @param id the ID of the voice channel
     * @throws IllegalStateException If the widget is not {@link #isAvailable() available}
     * @throws NumberFormatException If the provided {@code id} cannot be parsed by {@link
     *     Long#parseLong(String)}
     * @return possibly-null VoiceChannel with the given ID.
     */
    public VoiceChannel getVoiceChannelById(String id) {
<span class="nc" id="L363">      checkAvailable();</span>

<span class="nc" id="L365">      return channels.get(MiscUtil.parseSnowflake(id));</span>
    }

    /**
     * Gets a voice channel with the given ID, or {@code null} if the voice channel is not found
     *
     * @param id the ID of the voice channel
     * @throws IllegalStateException If the widget is not {@link #isAvailable() available}
     * @return possibly-null VoiceChannel with the given ID.
     */
    public VoiceChannel getVoiceChannelById(long id) {
<span class="nc" id="L376">      checkAvailable();</span>

<span class="nc" id="L378">      return channels.get(id);</span>
    }

    /**
     * Gets a list of online members in the guild
     *
     * @throws IllegalStateException If the widget is not {@link #isAvailable() available}
     * @return the list of members
     */
    public List&lt;Member&gt; getMembers() {
<span class="nc" id="L388">      checkAvailable();</span>

<span class="nc" id="L390">      return Collections.unmodifiableList(new ArrayList&lt;&gt;(members.valueCollection()));</span>
    }

    /**
     * Gets a member with the given ID, or null if the member is not found
     *
     * @param id the ID of the member
     * @throws NumberFormatException If the provided {@code id} cannot be parsed by {@link
     *     Long#parseLong(String)}
     * @throws IllegalStateException If the widget is not {@link #isAvailable() available}
     * @return possibly-null Member with the given ID.
     */
    public Member getMemberById(String id) {
<span class="nc" id="L403">      checkAvailable();</span>

<span class="nc" id="L405">      return members.get(MiscUtil.parseSnowflake(id));</span>
    }

    /**
     * Gets a member with the given ID, or {@code null} if the member is not found
     *
     * @param id the ID of the member
     * @throws IllegalStateException If the widget is not {@link #isAvailable() available}
     * @return possibly-null Member with the given ID.
     */
    public Member getMemberById(long id) {
<span class="nc" id="L416">      checkAvailable();</span>

<span class="nc" id="L418">      return members.get(id);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L423">      return Long.hashCode(id);</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="nc bnc" id="L428" title="All 2 branches missed.">      if (!(obj instanceof Widget)) return false;</span>
<span class="nc" id="L429">      Widget oWidget = (Widget) obj;</span>
<span class="nc bnc" id="L430" title="All 4 branches missed.">      return this == oWidget || this.id == oWidget.getIdLong();</span>
    }

    @Override
    public String toString() {
<span class="nc bnc" id="L435" title="All 2 branches missed.">      return &quot;W:&quot; + (isAvailable() ? getName() : &quot;&quot;) + '(' + id + ')';</span>
    }

    private void checkAvailable() {
<span class="nc bnc" id="L439" title="All 2 branches missed.">      if (!isAvailable)</span>
<span class="nc" id="L440">        throw new IllegalStateException(&quot;The widget for this Guild is unavailable!&quot;);</span>
<span class="nc" id="L441">    }</span>

    public static class Member implements ISnowflake, IMentionable {
      private final boolean bot;
      private final long id;
      private final String username;
      private final String discriminator;
      private final String avatar;
      private final String nickname;
      private final OnlineStatus status;
      private final Game game;
      private final Widget widget;
      private VoiceState state;

<span class="nc" id="L455">      private Member(JSONObject json, Widget widget) {</span>
<span class="nc" id="L456">        this.widget = widget;</span>
<span class="nc" id="L457">        this.bot = Helpers.optBoolean(json, &quot;bot&quot;);</span>
<span class="nc" id="L458">        this.id = json.getLong(&quot;id&quot;);</span>
<span class="nc" id="L459">        this.username = json.getString(&quot;username&quot;);</span>
<span class="nc" id="L460">        this.discriminator = json.getString(&quot;discriminator&quot;);</span>
<span class="nc" id="L461">        this.avatar = json.optString(&quot;avatar&quot;, null);</span>
<span class="nc" id="L462">        this.nickname = json.optString(&quot;nick&quot;, null);</span>
<span class="nc" id="L463">        this.status = OnlineStatus.fromKey(json.getString(&quot;status&quot;));</span>
<span class="nc" id="L464">        this.game =</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">            json.isNull(&quot;game&quot;) ? null : EntityBuilder.createGame(json.getJSONObject(&quot;game&quot;));</span>
<span class="nc" id="L466">      }</span>

      private void setVoiceState(VoiceState voiceState) {
<span class="nc" id="L469">        state = voiceState;</span>
<span class="nc" id="L470">      }</span>

      /**
       * Returns whether or not the given member is a bot account
       *
       * @return true if the member is a bot, false otherwise
       */
      public boolean isBot() {
<span class="nc" id="L478">        return bot;</span>
      }

      /**
       * Returns the username of the member
       *
       * @return the username of the member
       */
      public String getName() {
<span class="nc" id="L487">        return username;</span>
      }

      @Override
      public long getIdLong() {
<span class="nc" id="L492">        return id;</span>
      }

      @Override
      public String getAsMention() {
<span class="nc" id="L497">        return &quot;&lt;@&quot; + getId() + &quot;&gt;&quot;;</span>
      }

      /**
       * Gets the discriminator of the member
       *
       * @return the never-null discriminator of the member
       */
      public String getDiscriminator() {
<span class="nc" id="L506">        return discriminator;</span>
      }

      /**
       * Gets the avatar hash of the member, or null if they do not have an avatar set.
       *
       * @return possibly-null String containing the avatar hash of the member
       */
      public String getAvatarId() {
<span class="nc" id="L515">        return avatar;</span>
      }

      /**
       * Gets the avatar url of the member, or null if they do not have an avatar set.
       *
       * @return possibly-null String containing the avatar url of the member
       */
      public String getAvatarUrl() {
<span class="nc bnc" id="L524" title="All 2 branches missed.">        return getAvatarId() == null</span>
            ? null
            : &quot;https://cdn.discordapp.com/avatars/&quot;
<span class="nc" id="L527">                + getId()</span>
                + &quot;/&quot;
<span class="nc" id="L529">                + getAvatarId()</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">                + (getAvatarId().startsWith(&quot;a_&quot;) ? &quot;.gif&quot; : &quot;.png&quot;);</span>
      }

      /**
       * Gets the asset id of the member's default avatar
       *
       * @return never-null String containing the asset id of the member's default avatar
       */
      public String getDefaultAvatarId() {
<span class="nc" id="L539">        return UserImpl.DefaultAvatar</span>
<span class="nc" id="L540">            .values()[Integer.parseInt(getDiscriminator()) % UserImpl.DefaultAvatar.values().length]</span>
<span class="nc" id="L541">            .toString();</span>
      }

      /**
       * Gets the url of the member's default avatar
       *
       * @return never-null String containing the url of the member's default avatar
       */
      public String getDefaultAvatarUrl() {
<span class="nc" id="L550">        return &quot;https://discordapp.com/assets/&quot; + getDefaultAvatarId() + &quot;.png&quot;;</span>
      }

      /**
       * The URL for the user's avatar image &lt;br&gt;
       * If they do not have an avatar set, this will return the URL of their default avatar
       *
       * @return Never-null String containing the member's effective avatar url.
       */
      public String getEffectiveAvatarUrl() {
<span class="nc bnc" id="L560" title="All 2 branches missed.">        return getAvatarUrl() == null ? getDefaultAvatarUrl() : getAvatarUrl();</span>
      }

      /**
       * Gets the nickname of the member. If they do not have a nickname on the guild, this will
       * return null;
       *
       * @return possibly-null String containing the nickname of the member
       */
      public String getNickname() {
<span class="nc" id="L570">        return nickname;</span>
      }

      /**
       * Gets the visible name of the member. If they have a nickname set, this will be their
       * nickname. Otherwise, it will be their username.
       *
       * @return never-null String containing the member's effective (visible) name
       */
      public String getEffectiveName() {
<span class="nc bnc" id="L580" title="All 2 branches missed.">        return nickname == null ? username : nickname;</span>
      }

      /**
       * Gets the online status of the member. The widget does not show offline members, so this
       * status should never be offline
       *
       * @return the {@link net.dv8tion.jda.core.OnlineStatus OnlineStatus} of the member
       */
      public OnlineStatus getOnlineStatus() {
<span class="nc" id="L590">        return status;</span>
      }

      /**
       * The game that the member is currently playing. &lt;br&gt;
       * This game cannot be a stream. If the user is not currently playing a game, this will return
       * null.
       *
       * @return Possibly-null {@link net.dv8tion.jda.core.entities.Game Game} containing the game
       *     that the member is currently playing.
       */
      public Game getGame() {
<span class="nc" id="L602">        return game;</span>
      }

      /**
       * The current voice state of the member. &lt;br&gt;
       * If the user is not in voice, this will return a VoiceState with a null channel.
       *
       * @return never-null VoiceState of the member
       */
      public VoiceState getVoiceState() {
<span class="nc bnc" id="L612" title="All 2 branches missed.">        return state == null ? new VoiceState(this, widget) : state;</span>
      }

      /**
       * Gets the widget that to which this member belongs
       *
       * @return the Widget that holds this member
       */
      public Widget getWidget() {
<span class="nc" id="L621">        return widget;</span>
      }

      @Override
      public int hashCode() {
<span class="nc" id="L626">        return (widget.getId() + ' ' + id).hashCode();</span>
      }

      @Override
      public boolean equals(Object obj) {
<span class="nc bnc" id="L631" title="All 2 branches missed.">        if (!(obj instanceof Member)) return false;</span>
<span class="nc" id="L632">        Member oMember = (Member) obj;</span>
<span class="nc bnc" id="L633" title="All 2 branches missed.">        return this == oMember</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">            || (this.id == oMember.getIdLong()</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">                &amp;&amp; this.widget.getIdLong() == oMember.getWidget().getIdLong());</span>
      }

      @Override
      public String toString() {
<span class="nc" id="L640">        return &quot;W.M:&quot; + getName() + '(' + id + ')';</span>
      }
    }

    public static class VoiceChannel implements ISnowflake {
      private final int position;
      private final long id;
      private final String name;
      private final List&lt;Member&gt; members;
      private final Widget widget;

<span class="nc" id="L651">      private VoiceChannel(JSONObject json, Widget widget) {</span>
<span class="nc" id="L652">        this.widget = widget;</span>
<span class="nc" id="L653">        this.position = json.getInt(&quot;position&quot;);</span>
<span class="nc" id="L654">        this.id = json.getLong(&quot;id&quot;);</span>
<span class="nc" id="L655">        this.name = json.getString(&quot;name&quot;);</span>
<span class="nc" id="L656">        this.members = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L657">      }</span>

      private void addMember(Member member) {
<span class="nc" id="L660">        members.add(member);</span>
<span class="nc" id="L661">      }</span>

      /**
       * Gets the integer position of the channel
       *
       * @return integer position of the channel
       */
      public int getPosition() {
<span class="nc" id="L669">        return position;</span>
      }

      @Override
      public long getIdLong() {
<span class="nc" id="L674">        return id;</span>
      }

      /**
       * Gets the name of the channel
       *
       * @return name of the channel
       */
      public String getName() {
<span class="nc" id="L683">        return name;</span>
      }

      /**
       * Gets a list of all members in the channel
       *
       * @return never-null, possibly-empty list of members in the channel
       */
      public List&lt;Member&gt; getMembers() {
<span class="nc" id="L692">        return members;</span>
      }

      /**
       * Gets the Widget to which this voice channel belongs
       *
       * @return the Widget object that holds this voice channel
       */
      public Widget getWidget() {
<span class="nc" id="L701">        return widget;</span>
      }

      @Override
      public int hashCode() {
<span class="nc" id="L706">        return Long.hashCode(id);</span>
      }

      @Override
      public boolean equals(Object obj) {
<span class="nc bnc" id="L711" title="All 2 branches missed.">        if (!(obj instanceof VoiceChannel)) return false;</span>
<span class="nc" id="L712">        VoiceChannel oVChannel = (VoiceChannel) obj;</span>
<span class="nc bnc" id="L713" title="All 4 branches missed.">        return this == oVChannel || this.id == oVChannel.getIdLong();</span>
      }

      @Override
      public String toString() {
<span class="nc" id="L718">        return &quot;W.VC:&quot; + getName() + '(' + id + ')';</span>
      }
    }

    public static class VoiceState {
      private final VoiceChannel channel;
      private final boolean muted;
      private final boolean deafened;
      private final boolean suppress;
      private final boolean selfMute;
      private final boolean selfDeaf;
      private final Member member;
      private final Widget widget;

      private VoiceState(Member member, Widget widget) {
<span class="nc" id="L733">        this(null, false, false, false, false, false, member, widget);</span>
<span class="nc" id="L734">      }</span>

      private VoiceState(
          VoiceChannel channel,
          boolean muted,
          boolean deafened,
          boolean suppress,
          boolean selfMute,
          boolean selfDeaf,
          Member member,
<span class="nc" id="L744">          Widget widget) {</span>
<span class="nc" id="L745">        this.channel = channel;</span>
<span class="nc" id="L746">        this.muted = muted;</span>
<span class="nc" id="L747">        this.deafened = deafened;</span>
<span class="nc" id="L748">        this.suppress = suppress;</span>
<span class="nc" id="L749">        this.selfMute = selfMute;</span>
<span class="nc" id="L750">        this.selfDeaf = selfDeaf;</span>
<span class="nc" id="L751">        this.member = member;</span>
<span class="nc" id="L752">        this.widget = widget;</span>
<span class="nc" id="L753">      }</span>

      /**
       * Gets the channel the member is in
       *
       * @return never-null VoiceChannel
       */
      public VoiceChannel getChannel() {
<span class="nc" id="L761">        return channel;</span>
      }

      /**
       * Used to determine if the member is currently in a voice channel. &lt;br&gt;
       * If this is false, getChannel() will return null
       *
       * @return True, if the member is in a voice channel
       */
      public boolean inVoiceChannel() {
<span class="nc bnc" id="L771" title="All 2 branches missed.">        return channel != null;</span>
      }

      /**
       * Whether the member is muted by an admin
       *
       * @return True, if the member is muted
       */
      public boolean isGuildMuted() {
<span class="nc" id="L780">        return muted;</span>
      }

      /**
       * Whether the member is deafened by an admin
       *
       * @return True, if the member is deafened
       */
      public boolean isGuildDeafened() {
<span class="nc" id="L789">        return deafened;</span>
      }

      /**
       * Whether the member is suppressed
       *
       * @return True, if the member is suppressed
       */
      public boolean isSuppressed() {
<span class="nc" id="L798">        return suppress;</span>
      }

      /**
       * Whether the member is self-muted
       *
       * @return True, if the member is self-muted
       */
      public boolean isSelfMuted() {
<span class="nc" id="L807">        return selfMute;</span>
      }

      /**
       * Whether the member is self-deafened
       *
       * @return True, if the member is self-deafened
       */
      public boolean isSelfDeafened() {
<span class="nc" id="L816">        return selfDeaf;</span>
      }

      /**
       * Whether the member is muted, either by an admin or self-muted
       *
       * @return True, if the member is self-muted or guild-muted
       */
      public boolean isMuted() {
<span class="nc bnc" id="L825" title="All 4 branches missed.">        return selfMute || muted;</span>
      }

      /**
       * Whether the member is deafened, either by an admin or self-deafened
       *
       * @return True, if the member is self-deafened or guild-deafened
       */
      public boolean isDeafened() {
<span class="nc bnc" id="L834" title="All 4 branches missed.">        return selfDeaf || deafened;</span>
      }

      public Member getMember() {
<span class="nc" id="L838">        return member;</span>
      }

      public Widget getWidget() {
<span class="nc" id="L842">        return widget;</span>
      }

      @Override
      public int hashCode() {
<span class="nc" id="L847">        return member.hashCode();</span>
      }

      @Override
      public boolean equals(Object obj) {
<span class="nc bnc" id="L852" title="All 2 branches missed.">        if (!(obj instanceof VoiceState)) return false;</span>
<span class="nc" id="L853">        VoiceState oState = (VoiceState) obj;</span>
<span class="nc bnc" id="L854" title="All 2 branches missed.">        return this == oState</span>
<span class="nc bnc" id="L855" title="All 4 branches missed.">            || (this.member.equals(oState.getMember()) &amp;&amp; this.widget.equals(oState.getWidget()));</span>
      }

      @Override
      public String toString() {
<span class="nc" id="L860">        return &quot;VS:&quot; + widget.getName() + ':' + member.getEffectiveName();</span>
      }
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>